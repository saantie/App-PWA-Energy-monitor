<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Energy Monitor - Solar Analysis</title>
  <meta name="description" content="‡πÅ‡∏≠‡∏û‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏™‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="theme-color" content="#2196f3">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="EnergyMeter">
  <meta name="msapplication-TileColor" content="#2196f3">
  <meta name="msapplication-TileImage" content="icons/icon-192.png">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { margin: 0; padding: 0; height: 100vh; background: #f7f7f7; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; display: flex; flex-direction: column; overflow: hidden; }
    #loading { position: absolute; top: 0; left: 0; width: 100%; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; transition: opacity 0.5s ease; }
    #loading.hidden { opacity: 0; pointer-events: none; }
    .loader { width: 50px; height: 50px; border: 5px solid rgba(255, 255, 255, 0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text { color: white; margin-top: 20px; font-size: 16px; font-weight: 500; }
    .iframe-container { width: 100%; height: 100vh; position: relative; display: flex; flex-direction: column; }
    iframe { border: none; width: 100%; flex: 1; background: white; }
    #installPrompt { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 16px; display: none; flex-direction: column; gap: 12px; z-index: 999; max-width: 380px; width: 90%; box-shadow: 0 8px 32px rgba(0,0,0,0.2); animation: slideUp 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
    @keyframes slideUp { from { transform: translateX(-50%) translateY(120px) scale(0.8); opacity: 0; } to { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; } }
    #installPrompt.show { display: flex; }
    #installPrompt .prompt-header { display: flex; align-items: center; gap: 12px; margin-bottom: 4px; }
    #installPrompt .prompt-icon { width: 48px; height: 48px; background: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 28px; flex-shrink: 0; }
    #installPrompt .prompt-title { color: white; font-size: 18px; font-weight: 700; line-height: 1.2; flex: 1; }
    #installPrompt .close-btn { background: rgba(255, 255, 255, 0.2); color: white; border: none; width: 32px; height: 32px; border-radius: 8px; cursor: pointer; font-size: 18px; transition: all 0.2s; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-family: inherit; }
    #installPrompt .close-btn:hover { background: rgba(255, 255, 255, 0.3); }
    #installPrompt .close-btn:active { transform: scale(0.9); }
    #installPrompt .prompt-text { color: rgba(255, 255, 255, 0.95); font-size: 14px; line-height: 1.5; margin-bottom: 8px; }
    #installPrompt .prompt-features { display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; }
    #installPrompt .feature-item { display: flex; align-items: center; gap: 8px; color: white; font-size: 13px; }
    #installPrompt .feature-item::before { content: "‚úì"; display: flex; align-items: center; justify-content: center; width: 20px; height: 20px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; font-size: 12px; font-weight: bold; flex-shrink: 0; }
    #installPrompt button#installBtn { background: white; color: #667eea; border: none; padding: 14px 24px; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 700; transition: all 0.2s; width: 100%; font-family: inherit; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    #installPrompt button#installBtn:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.15); }
    #installPrompt button#installBtn:active { transform: translateY(0); }
    @media (max-width: 480px) {
      #installPrompt { bottom: 12px; left: 12px; right: 12px; transform: none; max-width: none; width: auto; padding: 18px; }
      @keyframes slideUp { from { transform: translateY(120px) scale(0.9); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
      #installPrompt .prompt-icon { width: 44px; height: 44px; font-size: 24px; }
      #installPrompt .prompt-title { font-size: 16px; }
      #installPrompt .prompt-text { font-size: 13px; }
      #installPrompt .feature-item { font-size: 12px; }
      #installPrompt button#installBtn { padding: 12px 20px; font-size: 15px; }
    }
  </style>
</head>
<body>
  <div id="loading">
    <div class="loader"></div>
    <div class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
  </div>
  <div id="installPrompt">
    <div class="prompt-header">
      <div class="prompt-icon">‚ö°</div>
      <div class="prompt-title">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Energy Monitor</div>
      <button class="close-btn" id="closePrompt" aria-label="‡∏õ‡∏¥‡∏î">‚úï</button>
    </div>
    <div class="prompt-text">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏≠‡∏û‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß</div>
    <div class="prompt-features">
      <div class="feature-item">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</div>
      <div class="feature-item">‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏≠‡∏û‡∏õ‡∏Å‡∏ï‡∏¥</div>
      <div class="feature-item">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
    </div>
    <button id="installBtn">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏•‡∏¢</button>
  </div>
  <div class="iframe-container">
    <iframe id="mainFrame" src="https://script.google.com/macros/s/AKfycbyiA_ifaXKxxC1o0lIUZh4EtJLAD_8kptWQNs_fWjs4um_DagwWiNGIrMat3p0HDytf/exec" allow="accelerometer; gyroscope" loading="lazy"></iframe>
  </div>
  <script>
    window.addEventListener('load',()=>{setTimeout(()=>document.getElementById('loading').classList.add('hidden'),1000)});
    document.getElementById('mainFrame').addEventListener('load',()=>console.log('‚úÖ Content loaded'));

    // Online/Offline
    let wasOffline=!navigator.onLine;
    window.addEventListener('online',()=>{console.log('üü¢ Online');if(wasOffline){const n=document.createElement('div');n.style.cssText='position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#4ade80;color:white;padding:12px 24px;border-radius:8px;font-size:14px;font-weight:600;box-shadow:0 4px 12px rgba(0,0,0,0.2);z-index:10000;animation:slideDown 0.3s';n.textContent='‚úì ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä...';document.body.appendChild(n);setTimeout(()=>location.reload(),1000)}wasOffline=false});
    window.addEventListener('offline',()=>{console.log('üî¥ Offline');wasOffline=true;const n=document.createElement('div');n.style.cssText='position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#ef4444;color:white;padding:12px 24px;border-radius:8px;font-size:14px;font-weight:600;box-shadow:0 4px 12px rgba(0,0,0,0.2);z-index:10000;animation:slideDown 0.3s';n.textContent='‚ö† ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï';document.body.appendChild(n);setTimeout(()=>n.remove(),3000)});

    // Pull-to-Refresh
    let startY=0,endY=0,pulling=false;
    const ind=document.createElement('div');
    ind.style.cssText='position:fixed;top:-60px;left:50%;transform:translateX(-50%);width:40px;height:40px;background:rgba(255,255,255,0.95);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;box-shadow:0 2px 10px rgba(0,0,0,0.2);transition:top 0.3s,transform 0.3s;z-index:9999';
    ind.innerHTML='‚Üì';
    document.body.appendChild(ind);
    document.addEventListener('touchstart',e=>{if(window.scrollY===0){startY=e.touches[0].clientY;pulling=true}},{passive:false});
    document.addEventListener('touchmove',e=>{if(!pulling)return;endY=e.touches[0].clientY;const d=endY-startY;if(d>0){const p=Math.min(d/80,1);ind.style.top=`${Math.min(d-60,20)}px`;if(d>=80){ind.style.transform='translateX(-50%) rotate(180deg)';ind.innerHTML='‚Üª'}else{ind.style.transform=`translateX(-50%) rotate(${p*180}deg)`;ind.innerHTML='‚Üì'}if(d>10)e.preventDefault()}},{passive:false});
    document.addEventListener('touchend',()=>{if(!pulling)return;const d=endY-startY;if(d>=80){ind.innerHTML='‚Üª';ind.style.animation='spin 1s linear infinite';setTimeout(()=>location.reload(),300)}ind.style.top='-60px';ind.style.transform='translateX(-50%)';ind.style.animation='';ind.innerHTML='‚Üì';pulling=false;startY=0;endY=0});

    const s=document.createElement('style');
    s.textContent='@keyframes slideDown{from{transform:translateX(-50%) translateY(-100px);opacity:0}to{transform:translateX(-50%) translateY(0);opacity:1}}@keyframes spin{from{transform:translateX(-50%) rotate(0deg)}to{transform:translateX(-50%) rotate(360deg)}}';
    document.head.appendChild(s);

    // Service Worker
    if('serviceWorker' in navigator){window.addEventListener('load',()=>{navigator.serviceWorker.register('./service-worker.js').then(r=>console.log('‚úÖ SW:',r.scope)).catch(e=>console.error('‚ùå SW:',e))})}

    // PWA Install
    let deferredPrompt;
    const installPrompt=document.getElementById('installPrompt');
    const installBtn=document.getElementById('installBtn');
    const closePrompt=document.getElementById('closePrompt');
    window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredPrompt=e;installPrompt.classList.add('show');console.log('üì± PWA ready')});
    installBtn.addEventListener('click',async()=>{if(deferredPrompt){deferredPrompt.prompt();const{outcome}=await deferredPrompt.userChoice;console.log('User:',outcome);deferredPrompt=null;installPrompt.classList.remove('show')}});
    closePrompt.addEventListener('click',()=>installPrompt.classList.remove('show'));
    window.addEventListener('appinstalled',()=>{console.log('‚úÖ PWA installed');installPrompt.classList.remove('show');deferredPrompt=null});
    if(window.matchMedia('(display-mode: standalone)').matches||window.navigator.standalone===true){console.log('‚úÖ Standalone')}
  </script>
</body>
</html>
